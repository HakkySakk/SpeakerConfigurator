<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>HÃ¶gtalarkonfigurator</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

  <nav>
    <button onclick="showSection('standard')">ðŸ§± Standardkabinett</button>
    <button onclick="showSection('horn')">ðŸ”Š Folded Horn</button>
  </nav>

  <main>
    <!-- ðŸ§± STANDARD -->
    <section id="standardSection">
      <h1>Standardkabinetter</h1>
      <label>HÃ¶jd (mm): <input id="height" type="number" value="1000"></label>
      <label>Bredd (mm): <input id="width" type="number" value="300"></label>
      <label>Djup (mm): <input id="depth" type="number" value="400"></label><br>

      <label>Typ:
        <select id="cabinetType">
          <option value="sealed">Sluten</option>
          <option value="bassreflex">Basreflex</option>
        </select>
      </label><br>

      <label>VÃ¤ggtjocklek (mm): <input id="wallThickness" type="number" value="18"></label>
      <label>Material:
        <select id="materialType">
          <option value="mdf">MDF</option>
          <option value="plywood">Plywood</option>
          <option value="hdf">HDF</option>
        </select>
      </label><br>

      <label>Bas (antal): <input id="wooferCount" type="number" value="1"></label><br>
      <button onclick="calculateVolume()">BerÃ¤kna & Visa</button>
      <button onclick="exportToPDF()">Exportera till PDF</button>

      <div id="results"></div>
    </section>

    <!-- ðŸ”Š FOLDED HORN -->
    <section id="hornSection" class="hidden">
      <h1>Folded Horn</h1>
      <label>HornlÃ¤ngd (mm): <input id="hornLength" type="number" value="2000"></label>
      <label>Antal veck: <input id="folds" type="number" value="4" min="1" max="8"></label>
      <button onclick="drawHorn()">Visa horn</button>
      <div id="hornRange"></div>
      <canvas id="hornCanvas" width="800" height="300"></canvas>
    </section>
  </main>

  <script src="script.js"></script>
</body>
</html>

<css>
body {
  font-family: sans-serif;
  background: #f5f5f5;
  margin: 0;
  padding: 0;
}

nav {
  background: #222;
  padding: 10px;
  display: flex;
  gap: 10px;
}

nav button {
  color: white;
  background: #444;
  border: none;
  padding: 10px;
  cursor: pointer;
}

main {
  padding: 20px;
}

.hidden {
  display: none;
}

canvas {
  margin-top: 20px;
  border: 1px solid #333;
}
</css>

<Js>
function showSection(section) {
  document.getElementById("standardSection").classList.add("hidden");
  document.getElementById("hornSection").classList.add("hidden");

  if (section === "standard") {
    document.getElementById("standardSection").classList.remove("hidden");
  } else {
    document.getElementById("hornSection").classList.remove("hidden");
    drawHorn();
  }
}

const materialDensities = {
  mdf: 750,
  plywood: 600,
  hdf: 850
};

function simulateStandardResponse(volumeLiters, type, wooferSize) {
  const fs = 40 + (30 - wooferSize);
  let low = type === "sealed" ? Math.round(fs * Math.pow(60 / volumeLiters, 0.25)) : Math.round(38 - (volumeLiters / 10));
  let high = type === "sealed" ? 300 : 250;
  return `~${low} Hz â€“ ${high} Hz`;
}

function calculateVolume() {
  const h = parseInt(document.getElementById("height").value);
  const w = parseInt(document.getElementById("width").value);
  const d = parseInt(document.getElementById("depth").value);
  const wall = parseInt(document.getElementById("wallThickness").value);
  const mat = document.getElementById("materialType").value;
  const woofer = parseInt(document.getElementById("wooferCount").value);
  const type = document.getElementById("cabinetType").value;

  const volume = ((h - 2 * wall) * (w - 2 * wall) * (d - 2 * wall)) / 1000;
  const materialVol = ((h * w * d - (h - 2 * wall) * (w - 2 * wall) * (d - 2 * wall)) / 1000).toFixed(1);
  const weight = (materialVol * materialDensities[mat] / 1000).toFixed(1);
  const freq = simulateStandardResponse(volume, type, 30);

  document.getElementById("results").innerHTML = `
    <p><strong>Inre volym:</strong> ${volume.toFixed(1)} liter</p>
    <p><strong>Materialvolym:</strong> ${materialVol} liter</p>
    <p><strong>Vikt:</strong> ${weight} kg</p>
    <p><strong>Simulerat frekvensomfÃ¥ng:</strong> ${freq}</p>
  `;
}

function exportToPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const h = parseInt(document.getElementById("height").value);
  const w = parseInt(document.getElementById("width").value);
  const d = parseInt(document.getElementById("depth").value);
  const wall = parseInt(document.getElementById("wallThickness").value);
  const mat = document.getElementById("materialType").value;
  const woofer = parseInt(document.getElementById("wooferCount").value);
  const type = document.getElementById("cabinetType").value;
  const volume = ((h - 2 * wall) * (w - 2 * wall) * (d - 2 * wall)) / 1000;
  const freq = simulateStandardResponse(volume, type, 30);

  doc.text("HÃ¶gtalarkabinett â€“ Export", 10, 10);
  doc.text(`Typ: ${type}`, 10, 20);
  doc.text(`MÃ¥tt: H=${h} mm, B=${w} mm, D=${d} mm`, 10, 30);
  doc.text(`Material: ${mat.toUpperCase()}, Tjocklek: ${wall} mm`, 10, 40);
  doc.text(`Volym: ${volume.toFixed(1)} liter`, 10, 50);
  doc.text(`FrekvensomfÃ¥ng: ${freq}`, 10, 60);

  doc.save("hogtalarkabinett.pdf");
}

function simulateHornResponse(hornLengthMm) {
  const L = hornLengthMm / 1000;
  const c = 343;
  const f1 = Math.round(c / (4 * L));
  return `~${f1} Hz â€“ ${f1 * 5} Hz`;
}

function drawHorn() {
  const canvas = document.getElementById("hornCanvas");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const L = parseInt(document.getElementById("hornLength").value);
  const folds = parseInt(document.getElementById("folds").value);
  const foldW = canvas.width / folds;
  const margin = 20;

  ctx.beginPath();
  ctx.moveTo(margin, margin);
  for (let i = 0; i < folds; i++) {
    const x = (i + 1) * foldW;
    const y = i % 2 === 0 ? canvas.height - margin : margin;
    ctx.lineTo(x, y);
  }
  ctx.stroke();

  // Tryckpunkter
  for (let i = 0; i <= folds; i++) {
    const x = i * foldW + margin;
    const y = i % 2 === 0 ? margin : canvas.height - margin;
    ctx.beginPath();
    ctx.arc(x, y, 5, 0, 2 * Math.PI);
    ctx.fillStyle = i % 2 === 0 ? '#007BFF' : '#FF0000';
    ctx.fill();
  }

  document.getElementById("hornRange").innerText = `FrekvensomfÃ¥ng: ${simulateHornResponse(L)}`;


}

  </js>
